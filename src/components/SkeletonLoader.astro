---
export interface SkeletonLoaderProps {
  type: 'card' | 'article' | 'avatar' | 'text' | 'image' | 'custom';
  className?: string;
  width?: string;
  height?: string;
  lines?: number;
  animated?: boolean;
}

const {
  type,
  className = '',
  width = '100%',
  height = 'auto',
  lines = 3,
  animated = true,
} = Astro.props as SkeletonLoaderProps;

// Generate skeleton classes based on type using new CLS-safe utilities
const getSkeletonClasses = (skeletonType: string) => {
  const baseClasses = 'skeleton reserve-space';
  const animationClass = animated ? 'animate-shimmer' : '';
  
  switch (skeletonType) {
    case 'card':
      return `${baseClasses} ${animationClass} reserve-card`;
    case 'article':
      return `${baseClasses} ${animationClass}`;
    case 'avatar':
      return `skeleton-avatar ${animationClass}`;
    case 'text':
      return `skeleton-text ${animationClass}`;
    case 'image':
      return `${baseClasses} ${animationClass} img-stable`;
    default:
      return `${baseClasses} ${animationClass}`;
  }
};

const skeletonClasses = getSkeletonClasses(type);

// Ensure variables are used
void skeletonClasses;
---

{type === 'card' && (
  <div class={`reserve-card stable-flex flex-col ${className}`} style={`width: ${width}; height: ${height}`}>
    <!-- Card Image Skeleton -->
    <div class={`skeleton aspect-video mb-4 reserve-thumbnail`}></div>
    
    <!-- Card Content Skeleton -->
    <div class="space-y-3 flex-1">
      <!-- Title -->
      <div class={`skeleton-text h-6 w-3/4`}></div>
      
      <!-- Description lines -->
      {Array.from({ length: lines }).map((_, index) => (
        <div class={`skeleton-text h-4 ${
          index === lines - 1 ? 'w-1/2' : 'w-full'
        }`}></div>
      ))}
      
      <!-- Meta info -->
      <div class="flex items-center gap-3 mt-4">
        <div class={`skeleton-avatar`}></div>
        <div class={`skeleton-text h-4 w-24`}></div>
      </div>
    </div>
  </div>
)}

{type === 'article' && (
  <div class={`reserve-space ${className}`} style={`width: ${width}; height: ${height}`}>
    <!-- Article Header Skeleton -->
    <div class="space-y-4 mb-8">
      <!-- Breadcrumbs -->
      <div class="flex items-center gap-2">
        <div class={`skeleton-text h-4 w-16`}></div>
        <div class={`skeleton-text h-4 w-4`}></div>
        <div class={`skeleton-text h-4 w-20`}></div>
      </div>
      
      <!-- Title -->
      <div class={`skeleton-text h-12 w-full mb-4`}></div>
      <div class={`skeleton-text h-12 w-3/4`}></div>
      
      <!-- Meta -->
      <div class="flex items-center gap-4">
        <div class={`skeleton-text h-4 w-20`}></div>
        <div class={`skeleton-text h-4 w-24`}></div>
      </div>
    </div>
    
    <!-- Featured Image Skeleton -->
    <div class={`skeleton aspect-video mb-8 reserve-thumbnail`}></div>
    
    <!-- Content Skeleton -->
    <div class="space-y-4">
      {Array.from({ length: lines }).map(() => (
        <div class={`skeleton-text h-4 w-full`}></div>
      ))}
      <div class={`skeleton-text h-4 w-2/3`}></div>
    </div>
  </div>
)}

{type === 'avatar' && (
  <div 
    class={`${skeletonClasses} ${className}`}
    style={`width: ${width}; height: ${height}`}
  ></div>
)}

{type === 'text' && (
  <div class="space-y-2 reserve-space">
    {Array.from({ length: lines }).map((_, index) => (
      <div 
        class={`${skeletonClasses} ${className} ${
          index === lines - 1 ? 'w-2/3' : 'w-full'
        }`}
        style={`height: ${height}`}
      ></div>
    ))}
  </div>
)}

{type === 'image' && (
  <div 
    class={`${skeletonClasses} ${className}`}
    style={`width: ${width}; height: ${height}`}
  ></div>
)}

{type === 'custom' && (
  <div 
    class={`${skeletonClasses} ${className}`}
    style={`width: ${width}; height: ${height}`}
  >
    <slot />
  </div>
)}

<style>
  /* Ensure skeleton loaders prevent layout shift using new utilities */
  .skeleton-container {
    transition: opacity 0.3s ease-in-out;
    contain: layout style;
  }
  
  .skeleton-container.loaded {
    opacity: 0;
    pointer-events: none;
  }
  
  /* Additional CLS prevention for skeleton elements */
  .skeleton,
  .skeleton-text,
  .skeleton-avatar {
    contain: layout style;
    will-change: auto; /* Prevent unnecessary compositing layers */
  }
  
  /* Smooth content replacement */
  .skeleton-fade-out {
    animation: fadeOut 0.3s ease-in-out forwards;
  }
  
  @keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
  }
</style>